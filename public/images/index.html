<!doctype html>
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>Magnet Mobile App Server Runtime</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Titillium+Web:200,300,400" rel="stylesheet" type="text/css">
    <style>
        /* page heading */
        #header{height:40px;padding:7px 13px;background:#000;color:#fff;position:relative}
        #header img{float:left;height:36px}
        #header h4{float:left;font-weight:normal;margin-left:10px;margin-top:9px}
        #mobile-header h3{color:#000;padding:10px}

        /* main body container */
        #container{margin:15px auto;width:95%}
        #container .title-heading{margin:2px 0 0 0;padding:0;font-size:12px}
        #container h4{margin-bottom:0;text-align:left}

        /* controller list */
        #controllers{margin-top:20px}
        #controllers h5{color:#222;font-size:12px;margin-left:14px}
        .accordion-group{border:none;margin-bottom:10px;border-radius:0 10px 10px 0;background:url(http://www.magnet.com/resources/sandbox/accordion_bg.png) repeat-y left top #EBEBEB}
        .accordion-inner{border:none}
        .accordion-body p{color:#777777;font-size:12px;margin:15px 0 15px 15px}
        .accordion *{outline:none}
        .accordion-toggle{float:right;padding:3px 9px 3px 3px !important}
        .accordion-heading{padding:3px 15px}
        .controller-method{padding:4px 6px 4px 6px;font-weight:bold;color:#fff;width:60px;text-align:center;float:left}
        .controller-path{padding:3px 6px;color:#222;margin-left:10px;float:left}
        .accordion-toggle i{margin-left:9px;background-position:-313px -119px}
        .accordion-toggle.active i{background-position:-288px -120px}
        .accordion-inner{padding:0 15px}

        /* misc */
        body{padding:0;margin:0}
        h5{font-size:13px;line-height:14px;margin-top:20px}
        .table{margin-left:20px;width:96%}
        .red{color:#ff0000;font-size:17px}
        .GET{background:#00a6ff}
        .PUT{background:#e36810}
        .DELETE{background:#c20000}
        .POST{background:#277d2a}

        /* introduction text panels */
        .list-spacing{height:15px}
        .well-wrapper{padding:20px 20px 20px 10px}
        .well{background-color:#eee}
        .well.light{background:#fff}
        .well.light img{float:left;margin-right:10px;width:64px}
        .docs-list{margin-top:30px;margin-left:75px}
        .docs-list li{margin:0;padding:0;list-style-type:none}
        .docs-list li a, .docs-list li a:link, .docs-list li a:visited{color:#008000}
    </style>
</head>
<body>

    <div id="header">
        <img src="http://www.magnet.com/_media/images/svg/magnet_logo.svg" />
        <h4>Mobile App Server Runtime</h4>
    </div>

    <div id="mobile-header">
        <h3>Mobile App Server Runtime</h3>
    </div>

    <div id="container" class="row-fluid">
        <div class="span7">
            <h4>Controller API Reference</h4>
            <p class="title-heading">Dynamically generated controllers</p>
            <div id="controllers" class="accordion"></div>
        </div>
        <div class="span5">
            <div class="well-wrapper">
                <div class="well">
                    <h3>Welcome!</h3>
                    <p class="intro-heading">
                        Congratulations on deploying your Magnet Mobile App Server Runtime. To get started developing
                        world class mobile apps, check out the documentation and view the list of controller APIs
                        available on this server.
                    </p>
                </div>
                <div class="well light">
                    <img src="http://www.magnet.com/resources/sandbox/icon_doclinks.png" />
                    <h4>Useful Documentation Links</h4>
                    <p class="title-heading">View the documentation to help you get started</p>
                    <ul class="docs-list clearfix">
                        <li class="list-spacing"><h5>Mobile App Developer Guides</h5></li>
                        <li><a href="https://factory.magnet.com/docs/android_developer_guide/pdf.pdf">Android Developer Guide</a></li>
                        <li><a href="https://factory.magnet.com/docs/ios_developer_guide/pdf.pdf">iOS Developer Guide</a></li>
                        <li class="list-spacing"><h5>API Documentation</h5></li>
                        <li><a href="https://factory.magnet.com/docs/android_client/">Android API Documentation</a></li>
                        <li><a href="https://factory.magnet.com/docs/ios_client/">iOS API Documentation</a></li>
                        <li><a href="https://factory.magnet.com/docs/server_javadocs/">Server Javadocs</a></li>
                        <li class="list-spacing"><h5>Resources</h5></li>
                        <li><a href="https://factory.magnet.com/resources/samples.html">Sample Projects</a></li>
                        <li><a href="https://github.com/magnetsystems/sdk-android">Android Mobile Server SDK Github Project</a></li>
                        <li><a href="https://github.com/magnetsystems/sdk-ios">iOS Mobile Server SDK Github Project</a></li>
                        <li><a href="https://github.com/magnetsystems/jumpstart-android">Android Jumpstart Sample App Github Project</a></li>
                        <li><a href="https://github.com/magnetsystems/jumpstart-ios">iOS Jumpstart Sample App Github Project</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

<script type="text/javascript" src="//code.jquery.com/jquery-1.10.1.min.js"></script>
<script type="text/javascript" src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.1/underscore-min.js"></script>
<script type="text/javascript">

    $(document).ready(function(){
        var me = this;
        me.el = 'controllers';
        var list = new ControllerList(me.el, function(){
            var accordion = new Accordion(me.el);
        });
        $(window).resize(function(){
            bindResize();
        });
        bindResize();
    });

    function Accordion(el){
        this.el = el;
        this.accordionLocked = false;
        this.bind();
    }
    Accordion.prototype.bind = function(){
        var me = this;
        $('#'+me.el+' .accordion-toggle').click(function(){
            me.toggleAccordion($(this));
        });
    };
    Accordion.prototype.toggleAccordion = function(current){
        var me = this;
        if(me.accordionLocked === false){
            me.accordionLocked = true;
            setTimeout(function(){
                me.accordionLocked = false;
            }, 340);
            if(current.hasClass('active')){
                setTimeout(function(){
                    current.removeClass('active');
                }, 240);
            }else{
                current.addClass('active');
            }
            var siblings = current.closest('.accordion').find('.accordion-toggle');
            $.each(siblings, function(){
                var item = $(this);
                if(item.hasClass('active') && item.attr('href') != current.attr('href')){
                    setTimeout(function(){
                        item.removeClass('active');
                    }, 240);
                }
            });
        }
    };

    function ControllerList(el, callback){
        var me = this;
        me.el = el;
        me.template = $('#ControllerListItemTmpl').html();
        me.request('rest/controllers.json', function(data){
            if(data && data.charAt(0) == '['){
                me.jsonFormat(data);
                callback();
            }
        });
    }
    ControllerList.prototype.jsonFormat = function(data){
        var me = this;
        $.each(data.controllers, function(i, obj){
            var item = {};
            item.name = obj.interfaceClassName.slice(obj.interfaceClassName.lastIndexOf('.')+1).toUpperCase();
            item.apis = [];
            $.each(obj.methods, function(i, api){
                var urlparams = [];
                var apiparams = [];
                $.each(api.parameters, function(i, param){
                    param.style = me.mapStyle(param.style);
                    if(api.path.indexOf('{'+param.name+'}') != -1){
                        urlparams.push(param);
                    }else{
                        apiparams.push(param);
                    }
                });
                item.apis.push({
                    api     : api.name,
                    url     : '/rest'+api.path,
                    methods : [{
                        method       : api.method,
                        isController : true,
                        description  : 'Invokes the method "' + api.name + '" on the server.',
                        properties   : urlparams.concat(apiparams)
                    }],
                    params  : urlparams
                });
            });
            me.render(item);
        });
    };
    ControllerList.prototype.render = function(item){
        $('#'+this.el).append(_.template(this.template, {
            item : item
        }));
    };
    ControllerList.prototype.request = function(url, callback){
        $.support.cors = true;
        $.ajax({
            url  : url,
            type : 'GET',
            success : function(data){
                callback(data);
            },
            error: function(xhr, status, options){
                console.log(xhr, status, options);
            }
        });
    }
    ControllerList.prototype.mapStyle = function(style){
        var mapped = style;
        switch(style){
            case 'QUERY' : mapped = 'Querystring'; break;
            case 'FORM'  : mapped = 'Form Data'; break;
            case 'PLAIN' : mapped = 'Plain Text'; break;
            case 'TEMPLATE' : mapped = 'URL Path'; break;
        }
        return mapped;
    }

    function bindResize(){
        var title = $('#header h4'), mobile = $('#mobile-header'), doclist = $('.docs-list'), paths = $('.controller-path'), img = $('.well.light img');
        var width = $(window).width();
        if(width > 1012){
            title.show();
            mobile.hide();
            doclist.css('margin-left', '75px');
            paths.css('font-size', '14px');
            img.css('display', 'inline');
        }else if(width <= 1012 && width > 440){
            title.show();
            mobile.hide();
            doclist.css('margin-left', '0');
            paths.css('font-size', '14px');
            img.css('display', 'none');
        }else{
            title.hide();
            mobile.show();
            doclist.css('margin-left', '0');
            paths.css('font-size', '12px');
            img.css('display', 'none');
        }
    }

</script>

<script id="ControllerListItemTmpl" type="text/template">
    <h5><%- item.name %></h5>
    <% _.each(item.apis, function(method, id){ %>
    <div class="accordion-group">
        <div class="accordion-heading clearfix">
            <div class="controller-method <%- method.methods[0].method %>"><%- method.methods[0].method %></div>
            <div class="controller-path"><%= method.url.replace('{target}', '<b>{target}</b>') %></div>
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#controllers" href="#<%- method.api.replace(/[^a-z0-9_]/gi,'') %>">
                <i class="icon-chevron-down"></i>
            </a>
        </div>
        <div id="<%- method.api.replace(/[^a-z0-9_]/gi,'') %>" class="accordion-body collapse">
            <p><%- method.methods[0].description %></p>
            <% if(method.methods[0].properties && method.methods[0].properties.length > 0){ %>
            <div class="accordion-inner">
                <table class="table">
                    <thead>
                    <tr>
                        <th>Property</th>
                        <th>Style</th>
                        <th>Type</th>
                    </tr>
                    </thead>
                    <tbody>
                    <% _.each(method.methods[0].properties, function(properties, id){ %>
                        <tr>
                            <td><%= (properties.style == 'URL Path' ? properties.name.replace('target', '<b>target</b>') : properties.name) %> <%= properties.optional ? '<span class="red">*</span>' : '' %></td>
                            <td><%- properties.style %></td>
                            <td><%- properties.type %></td>
                        </tr>
                    <% }); %>
                    </tbody>
                </table>
            </div>
            <% } %>
        </div>
    </div>
    <% }); %>
</script>

</body>
</html>